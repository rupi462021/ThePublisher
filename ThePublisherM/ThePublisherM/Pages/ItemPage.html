<!DOCTYPE html>
<html>
<head>
    <title>Show Room</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="style.css" rel="stylesheet" />

    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://vjs.zencdn.net/7.10.2/video.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <script src="../Scripts/ajaxCalls.js"></script>
    <script src="../Scripts/jquery-3.4.1.js"></script>
    <script src="../Scripts/jquery-3.4.1.min.js"></script>

    <style>
        .card-link {
            padding: 8px;
        }

        .wrap {
            justify-content: space-between;
        }

        .logo {
            overflow: hidden;
            position: relative;
            height: 60px;
            background-color: white;
            color: #1F6C8B;
            font-family: Arial;
        }

        #hello_user {
            margin-left: 600px;
        }

        .items {
            width: 900px;
            height: 250px;
            text-align: center;
            margin: 20px;
            border: 4px solid black;
            background-color: aquamarine;
            font-size: 80%;
        }

        .search_item {
            justify-content: space-between;
            padding: 10px;
        }

        .content-form {
            display: flex;
            justify-content: space-between;
            padding: 24px;
        }

        .list-head {
            padding: 24px 16px;
            display: flex;
            justify-content: space-between;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-content: center;
            justify-content: center;
        }

        body {
            direction: rtl;
            text-align: right;
        }

        .content-form {
            display: inline-flex;
            flex-direction: column;
            justify-content: space-around;
            height: 500px;
            background-color: lightgray;
            border: 1px solid #adb5bd;
            padding: 15px;
            width: 500px;
        }

        div.card-body {
            direction: rtl;
        }

        textarea {
            overflow: auto;
            resize: vertical;
            width: 400px;
        }
    </style>
    <style type="text/css">

        body {
            background-color: #dee2e6;
        }

        .red-star {
            color: red;
        }

        .form-group {
            margin-bottom: 1rem;
            padding: 5px;
        }

        .container {
            max-width: 1140px;
            background-color: beige;
        }
    </style>

    <script>
        $(document).ready(function () {
            console.log("ready!");
            checkUser();
            $("#logOut").click(function () {
                document.location = "login.html";
                localStorage.clear();
            });
            $("#getShow").click(showRend);
            /*$("#getShow").click(showVideo);*/
            $("#saveItem").click(saveItemD);
            /*showVideoTitle();*/
            ///*$("#vlist").change(getUrl);*/
            $("#testg").click(showVideoTitle);
        });
        function checkUser() {
            if (localStorage["userObject"] != null) {
                tastStr = JSON.parse(localStorage["userObject"]);
                $("#userName").append(tastStr.email);
            }
            else {
                tastStr = [];
            }
        }
        //in Success geting the show details from the xml file
        function showRend() {
            console.log("in rend");
            let api = "../api/Item";
            ajaxCall("GET", api, "", getShowSuccess, getShowError);
        }
        function getShowError(err) {
            console.log(err);
        }
        function getShowSuccess(data) {
            console.log(data);
            console.log("in Success");
            Data = data;
            $("#showItems").empty();
            $("#showItems").html("");
            str = "";
            for (var i = 0; i < Data.length; {
                str += "<div id='accordion'>"
                        str += "<div id='" + i + "' class='card'><div class='card-header'>";
                str += "<a class='card-link' data-toggle='collapse' href='#collapseOne'>"
                            + Data[i].ShowTitle + "</a >";
                str += "<a href='#' id='" + i + "' class='btn btn-primary' onclick='sendText(this)'>" + " עריכה " + "</a>";
                str += "<div id='collapseOne' id='" + i + "' class='collapse show' data-parent='#accordion'>";
                str += "<div class='card-body'><p>מספר תוכנית: " + Data[i].ShowId + "</p>";
                str += "<p class='scriptName'>" + Data[i].StoryName + "</p>";
                str += "<p> פורמט: " + Data[i].StoryFormat + "</p>";
                str += "<p class='scriptC'>" + Data[i].StoryScript + "</p>";
                str += "<p class='scriptId'>" + Data[i].StoryId + "</p>";
                str += "</div></div>";
                str += "</div></div>";
                str += "</div>";
            }
            $("#showItems").append(str);
        }
        //in Success geting the videos from data

        function sendText(cntrl) {
            console.log("in send");
            var by = cntrl.id;
            var tit = $("p.scriptName");
            var sid = $("p.scriptId");
            var desc = $("p.scriptC");
            $("#title-input").val(tit[by].innerHTML);
            $("#id-input").val(sid[by].innerHTML);
            $("#desc-input").val(desc[by].innerHTML);
        }
        /*chance*/
        let arr = [];
        //function showVideoTitle() {
        //    console.log("in rend");
        //    let api = "../api/Videos";
        //    ajaxCallLocal("GET", api, "", getTitle, getTitleError);
        //}
        //function getTitle(data) {
        //    console.log("success");
        //    strTitle = '<option value="-1">בחר</option>';
        //    for (var i = 0; i < data.length; i++) {
        //        strTitle += '<option value=' + data[i].Id + '>' + data[i].Title + '</option>'
        //    }
        //    $("#vlist").append(strTitle);
        //}
        //function getTitleError(data) {
        //    console.log("faild")
        //}
        /*chance*/
        //save the item details and show in item save page
        function saveItemD() {
            console.log("in save item");
            let _title = $("#title-input").val();
            let _storyNum = $("#id-input").val();
            let _description = $("#desc-input").val();
            let savedItem = { // Note that the name of the fields must be identical to the names of the properties of the object in the server

                Title: _title,
                StoryNum: _storyNum,
                Description: _description
            }
            ajaxCall("POST", "../api/SavedItem", JSON.stringify(savedItem), postSaveSuccess, postSaveError);
        }
        function postSaveSuccess(data) {
            swal("Added Successfuly!", "Great Job", "success");
            console.log(data);
        }
        function postSaveError(err) {
            swal("This item has been saved!", "Select another item");
            console.log(err.responseJSON);
        }
        function sendPost(msg) {
            let pageId = "104598111726735";
            console.log("trying to get page id from facebook API");
            let user_token = sessionStorage.getItem("token");
            let userID = sessionStorage.getItem("userID");
            //try to get page access token
            let url_get_page_access = "https://graph.facebook.com/" + pageId + "?fields=access_token&access_token=" + user_token;
            let page_acces_token = httpGet(url_get_page_access);
            var resp = JSON.parse(page_acces_token);
            let postUrl = "https://graph.facebook.com/" + pageId + "/feed?message=" + document.getElementById('desc-input').value + "&access_token=" + resp.access_token;
            let res = httpPost(postUrl);
            console.log(res);
        }
        // function for posting in twitter!!should be comm
        function sendPostTwitt(cntr) {
            alert("Twitter!");
            console.log("trying to get page id from twitter API");
            let apiTwit = "../api/Twitter";
            ajaxCall("GET", apiTwit, "", RequestTwittSuccess, RequestTwittError);
        }
        // the request twitter
        function RequestTwittSuccess(data) {
            console.log("Success!!!");
            console.log(data);
            DataT = data;
            postUrlTwitt = "https://twitter.com/intent/tweet?text=" + document.getElementById('desc-input').value + "&access_token=" + DataT;

            let resT = TwittPost(postUrlTwitt);
            console.log(resT);
        }
        // the request to post twitter
        function RequestTwittError(err) {
            console.log("Error!!!");
        }
        function TwittPost(url) {
            var xml = new XMLHttpRequest();
            xml.open('POST', url, false);
            xml.send();
            return xml.responseText;
        }
        function httpGet(url) {
            var xml = new XMLHttpRequest();
            xml.open('GET', url, false);
            xml.send(null);
            alert(xml.responseText);
            return xml.responseText;
        }
        function httpPost(url) {
            var xml = new XMLHttpRequest();
            xml.open('POST', url, false);
            xml.send();
            return xml.responseText;
        }
        window.fbAsyncInit = function () {
            FB.init({
                appId: '304468051299771',
                cookie: true,
                xfbml: true,
                version: 'v10.0'
            });
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        };
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        function statusChangeCallback(response) {
            if (response.status == "connected") {
                console.log("connected")
                sessionStorage.setItem("token", response.authResponse.accessToken);
                sessionStorage.setItem("userID", response.authResponse.userID);
            }
            else {
                console.log("not-connected")
                sessionStorage.clear();
            }
            console.log(response);
        }
        function checkLoginState() {
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        }
        function showVideoTitle() {
            console.log("in rend");
            let date = $("#dateTime").val();
            let startDate = $("#startTime").val();
            let endDate = $("#endTime").val();
            console.log(endDate)
            /*    let api = "../api/student/" + startDate + "/date/" + endDate;*/
            let api = "../api/Videos?from=" + startDate + "&to=" + endDate + "&date=" + date;
            /*let api = "../api/Videos";*/
            ajaxCall("GET", api, "", suc, err);

        }

        function suc(data) {
            $("#aaa").html('').append($('', { src: 'blah.gif' }));
            console.log("yess")
            console.log(data)
            arr = JSON.parse(data);
            console.log(arr.GetPlaybackResult.Result)
            video = `<video id="my-video"
                                        class="video-js"
                                        controls
                                        preload="auto"
                                        width="720px"
                                        height="264"


                                        data-setup="{}">
                                        <source src=${arr.GetPlaybackResult.Result} type="video/mp4" />

                                    </video>`
            $("#aaa").append(video);

        }
        function err(err) {
            console.log(err)
        }

        //function getUrl() {
        //    let id = $("#vlist").val();
        //    let api = "../api/videos/getItem?id=" + id;
        //    ajaxCallLocal("GET", api, "", getSuccessItem, getErrorItem);
        //}
        //function getSuccessItem(data) {
        //    $("#frame").html('').append($('', { src: 'blah.gif' }));
        //    console.log("YAHOOO");
        //    console.log(data[0].Ifrmae)
        //    let video = data[0].Ifrmae
        //    $("#frame").append(video);
        //}
        //function getErrorItem(data) {
        //    console.log("NOOOOOO")
        //}
        ////c
        ////function publish() {
        ////    let ttr = document.getElementById('desc-input').value;
        ////    $("data-text").append(ttr);
        ////}
        //function getUrl() {
        //    let id = $("#vlist").val();
        //    let api = "../api/videos/getItem?id=" + id;
        //    ajaxCallLocal("GET", api, "", getSuccessItem, getErrorItem);
        //}
        //function getSuccessItem(data) {
        //    $("#frame").html('').append($('', { src: 'blah.gif' }));
        //    console.log("YAHOOO");
        //    console.log(data[0].Ifrmae)
        //    let video = data[0].Ifrmae
        //    $("#frame").append(video);
        //    let startDate = "2021-05-17T12:00";
        //    let endDate = "2021-05-17T14:00";

        //    let api12 = "../api/Videos?from=" + startDate + "&to=" + endDate;

        //    ajaxCall("GET", api12, "", suc, err);
        //    console.log("heee");
        //}
        //function getErrorItem(err) {
        //    console.log(err);
        //}
        //function suc(data) {
        //    $("#aaa").html('').append($('', { src: 'blah.gif' }));
        //    console.log("yess")
        //    console.log(data)
        //    arr = JSON.parse(data);
        //    console.log(arr.GetPlaybackResult.Result)
        //    video = `<video id="my-video"
        //                                                                        class="video-js"
        //                                                                        controls
        //                                                                        preload="auto"
        //                                                                        width="720px"
        //                                                                        height="264"
        //                                                                        data-setup="{}">
        //                                                                        <source src=${arr.GetPlaybackResult.Result} type="video/mp4" />
        //                                                                    </video>`
        //    $("#aaa").append(video);

        //}
        //function err(err) {
        //    console.log(err);
        //}
    </script>
</head>
<body>
    <div class="jumbotron text-center" style="margin-bottom:0">
        <h1>כאן 11</h1>
    </div>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <a class="navbar-brand" href="#" onclick="document.location='MainPage.html'">ראשי</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="#">יצירת אייטם</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="document.location='SavedItems.html'">אייטמים שנשמרו</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="document.location='videoPage.html'">וידאו</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="document.location='Managerlogin.html'">כניסת מנהל</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="document.location='Analytics.html'">ניתוחים</a>
            </li>
            <li class="nav-item" style="float:left">
                <a class="nav-link" id="userName" href="#"></a>
            </li>
            <li class="nav-item" style="float:left">
                <a class="nav-link" id="logOut" href="#">Log Out</a>
            </li>
        </ul>
    </nav>
    <div class="container" style="margin-top:20px">
        <div class="row">
            <div class="col-sm-4" id="itemsDiv">
                <div class="list">
                    <div class="list-head">
                        <h2>תוכניות</h2>
                        <button id="getShow" type="button" class="btn btn-primary">ייבא תכנים</button>
                    </div>
                    <div class="fakeimg">
                        <br>
                        <div id="showItems"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="search_item">
                  
                    <h5>בחר שעת תוכנית</h5>
                    <div class="form-group">
                        <label for="dealerPhone"><span class="red-star">★ </span>date (In Format yyyy-mm-dd )</label>
                        <!--<label for="dealerPhone">Phone Number (In Format ddd-ddddddd )</label>-->
                        <input type="tel" class="form-control" placeholder="Enter date" id="dateTime"
                               pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}"
                               oninvalid="this.setCustomValidity('Phone Number pattern Is Not Valid')"
                               oninput="this.setCustomValidity('')" required />
                    </div>

                    <div class="form-group">
                        <label for="dealerPhone"><span class="red-star">★ </span>start time (In Format hh:mm )</label>
                        <!--<label for="dealerPhone">Phone Number (In Format ddd-ddddddd )</label>-->
                        <input type="tel" class="form-control" placeholder="Enter start time" id="startTime"
                               pattern="[0-9]{2}:[0-9]{2}"
                               oninvalid="this.setCustomValidity('Phone Number pattern Is Not Valid')"
                               oninput="this.setCustomValidity('')" required />
                    </div>
                    <div class="form-group">
                        <label for="dealerPhone"><span class="red-star">★ </span>end time (In Format hh:mm )</label>
                        <!--<label for="dealerPhone">Phone Number (In Format ddd-ddddddd )</label>-->
                        <input type="tel" class="form-control" placeholder="Enter end time" id="endTime"
                               pattern="[0-9]{2}:[0-9]{2}"
                               oninvalid="this.setCustomValidity('Phone Number pattern Is Not Valid')"
                               oninput="this.setCustomValidity('')" required />
                    </div>
                    <button  id="testg">חיתוך</button>

                    <div id="aaa">



                    </div>
                    <!--chance-->
                </div>
                <div id="frame" class="search_item">
                </div>
                <div class="row">
                    <div class="col">
                        <div class="content-form">
                            <div>
                                <label for="title-input">שם תכנית</label>
                                <input id="title-input" type="text" name="title-input" value="" /><br>
                                <label for="id-input">מספר תכנית</label>
                                <input id="id-input" type="text" name="id-input" value="" />
                            </div>
                            <div>
                                <label for="desc-input">תאור</label>
                                <textarea id="desc-input" name="desc-input" rows="10" cols="40"></textarea>
                            </div>
                            <!--<img src="https://img.icons8.com/fluent/50/000000/twitter.png" />-->
                            <!--<img src="https://img.icons8.com/fluent/50/000000/facebook-new.png" />-->
                            <!--<img src="https://img.icons8.com/officel/50/000000/youtube.png" />-->
                            <div id="social">
                                <fb:login-button scope="public_profile,email"
                                                 onlogin="checkLoginState();">
                                </fb:login-button>
                                <a href="https://twitter.com/intent/tweet?button_hashtag=login&ref_src=twsrc%5Etfw"
                                   class="twitter-hashtag-button" data-show-count="false">Tweet #login</a>
                            </div>
                            <!--<fb:login-button scope="public_profile,email"
                                             onlogin="checkLoginState();">
                            </fb:login-button>
                            <a href="https://twitter.com/intent/tweet?button_hashtag=login&ref_src=twsrc%5Etfw"
                               class="twitter-hashtag-button" data-show-count="false">Tweet #login</a>-->
                            <button id="saveItem">Save Item</button>
                            <button onclick="sendPost('TBD')" id="testBtn">Post Facebook</button>
                            <button onclick="sendPostTwitt('TBDT')" id="testBtn1">Post Twitter</button>
                            <!--<a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button"
                               data-show-count="false">Tweet</a>-->
                            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                            <!--<a href="https://twitter.com/intent/tweet?button_hashtag=login&ref_src=twsrc%5Etfw" class="twitter-hashtag-button" data-show-count="false">Tweet #login</a>-->
                            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                            <!--<a class="twitter-share-button"
       href="https://twitter.com/intent/tweet">
        Tweet
    </a>-->
                            <!--<a class="twitter-share-button"
                               href="https://twitter.com/intent/tweet?text=" + document.getElementById('desc-input').value>
                                Tweet
                            </a>-->

                            
                            <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" onclick="publish()" data-text="" data-show-count="false">Tweet</a>
                            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
            </div>
            <div class="col-sm-8">              
            </div>
        </div>
    </div>
    
    <div id="pphh">
        <!--test-->
        <!--<blockquote class="twitter-tweet"><p lang="en" dir="ltr">test😀</p>&mdash; rupi46 (@rupi46) 
        <a href="https://twitter.com/rupi46/status/1396040683681615875?ref_src=twsrc%5Etfw">May 22, 2021</a></blockquote>
        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>-->

    </div>
     <div class="jumbotron text-center" style="margin-bottom:0">
         <p>Footer</p>
     </div>
</body>
</html>
